<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kalistenika Tr√©ning</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      background: #0f1115;
      color: #fff;
      padding: 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 10px;
    }
    .workout-day {
      font-size: 1.2em;
      text-align: center;
      margin-bottom: 20px;
    }
    .exercise {
      background: #1a1d23;
      padding: 12px;
      border-radius: 10px;
      margin-bottom: 15px;
    }
    .exercise label {
      display: block;
      margin-bottom: 6px;
      font-size: 1em;
    }
    .exercise input {
      width: 80px;
      padding: 5px;
      font-size: 1em;
      border-radius: 5px;
      border: none;
    }
    button {
      display: block;
      width: 100%;
      padding: 12px;
      background: #0dbf8c;
      color: #000;
      border: none;
      border-radius: 10px;
      font-size: 1.1em;
      font-weight: bold;
      margin-top: 20px;
    }
    .status {
      text-align: center;
      margin-top: 15px;
      font-size: 1.1em;
      color: #0dbf8c;
    }
  </style>
</head>
<body>

  <h1>Kalistenika</h1>
  <div class="workout-day" id="today-day">Naƒç√≠tavam tr√©ning...</div>
  <div id="exercise-list"></div>
  <button onclick="submitWorkout()">üíæ Ulo≈æi≈• progres</button>
  <div class="status" id="status"></div>

  <script>
    const treningove_dni = {
      "De≈à 1 ‚Äì Nohy + Core": ["Pistol squat", "Wall sit (60s)", "Calf raises", "Leg raises", "Plank (60s)"],
      "De≈à 2 ‚Äì Hrudn√≠k + Triceps + L-sit": ["Incline push-ups", "Dipy", "Diamond push-ups", "L-sit (30s)", "Knee raises"],
      "De≈à 3 ‚Äì Chrb√°t + Biceps": ["Pull-ups", "Negative muscle-ups", "Australian rows", "Chin-ups", "Dead hang (30s)"],
      "De≈à 4 ‚Äì Beh + Ramena + Core": ["Pike push-ups", "Plank to push-up", "Shoulder taps", "Bird-dog"],
      "De≈à 5 ‚Äì Hrudn√≠k + Nohy": ["Push-ups", "Dipy", "Wide push-ups", "Wall sit (60s)", "Leg raises"]
    };

    const days = Object.keys(treningove_dni);
    const apiUrl = "https://script.google.com/macros/s/AKfycbwiDlSFZIVr5m9B98GXuXpXOEd43Cn4tY4Ug6MNWGB4ebMHTJDPxlVmda9ModBrNT06/exec";
    const dayDisplay = document.getElementById("today-day");
    const exerciseList = document.getElementById("exercise-list");
    const status = document.getElementById("status");

    async function getLastDayIndex() {
      try {
        const res = await fetch(apiUrl);
        const data = await res.json();
        if (!data || data.length === 0) return 0;

        const last = data[data.length - 1].Day;
        const index = days.findIndex(d => d === last);
        return (index + 1) % days.length;
      } catch {
        return 0; // fallback to day 1
      }
    }

    function renderExercises(dayName) {
      dayDisplay.textContent = dayName;
      const exercises = treningove_dni[dayName];
      exerciseList.innerHTML = "";

      exercises.forEach(ex => {
        const isTimer = ex.includes("(");
        const name = ex.replace(/\s*\(.*?\)/, "");
        const wrapper = document.createElement("div");
        wrapper.className = "exercise";

        const label = document.createElement("label");
        label.textContent = ex;
        const input = document.createElement("input");
        input.id = `rep-${name}`;
        input.type = "number";
        input.min = 0;
        input.placeholder = isTimer ? "sekundy" : "opakovania";

        wrapper.appendChild(label);
        wrapper.appendChild(input);
        exerciseList.appendChild(wrapper);
      });
    }

    async function init() {
      const dayIndex = await getLastDayIndex();
      const dayName = days[dayIndex];
      renderExercises(dayName);
    }

    async function submitWorkout() {
      const dayName = dayDisplay.textContent;
      const exercises = treningove_dni[dayName];
      const today = new Date().toISOString().split("T")[0];
      let errors = 0;

      for (const ex of exercises) {
        const name = ex.replace(/\s*\(.*?\)/, "");
        const reps = document.getElementById(`rep-${name}`).value || "0";
        const data = {
          Date: today,
          Day: dayName,
          Exercise: name,
          Reps: reps
        };
        try {
          await fetch(apiUrl, {
            method: "POST",
            headers: { "Content-Type": "text/plain;charset=utf-8" },
            body: JSON.stringify(data)
          });
        } catch {
          errors++;
        }
      }

      if (errors === 0) {
        status.textContent = "‚úÖ Progres ulo≈æen√Ω!";
      } else {
        status.textContent = "‚ö†Ô∏è Chyba pri ukladan√≠ d√°t.";
      }

      setTimeout(() => status.textContent = "", 4000);
    }

    init();
  </script>
</body>
</html>
